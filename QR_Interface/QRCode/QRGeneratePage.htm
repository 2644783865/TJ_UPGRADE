<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>二维码生成功能Demo</title>

    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>

    <script type="text/javascript" src="js/jquery.qrcode.js"></script>

    <script type="text/javascript" src="js/qrcode.js"></script>

    <script type="text/javascript" src="js/utf.js"></script>

    <script type="text/javascript">
        function GenerateQR(){
            $("#qrcodeImg").attr("src","");
            $('#qrcodeCanvas').html("");
            QRData=$("#QRData").val();
            QRWidth=$("#QRWidth").val();
            QRHeight=$("#QRHeight").val();
            var qrcode=$('#qrcodeCanvas').qrcode({
		     	 render:"canvas",
		         text:QRData,
		         width:QRWidth,             //二维码的宽度
                 height:QRHeight,           //二维码的高度
                 background:"#ffffff",      //二维码的后景色
                 foreground:"#000000",      //二维码的前景色
                 src:'img/gray.png'         //二维码中间的图片
		     });
		     var canvas=qrcode.find('canvas').get(0);
		     $('#qrcodeImg').attr('src',canvas.toDataURL('image/jpg'));
		     //downloadImage("测试图片");	
        }
        function downloadImage(name) {
		     //通过选择器获取img元素
		     var img = document.getElementById("qrcodeImg");
			 //将图片的src属性作为URL地址
			 var url = img.src;
			 var a = document.createElement('a');
			 var event = new MouseEvent('click');	
			 a.download = name;
			 a.href = url;
			 a.dispatchEvent(event);
		}		    
    </script>

</head>
<body>
    <div>
        二维码数据：
        <input type="text" id="QRData" style="width: 500px" />
        二维码图片宽度：
        <input type="text" id="QRWidth" style="width: 50px" />
        二维码图片高度：
        <input type="text" id="QRHeight" style="width: 50px" />
    </div>
    <div>
        <input type="button" id="btn_GenerateQR" value="生成二维码" onclick="GenerateQR()" />
    </div>
    <div id="qrcodeCanvas" style="display: none">
    </div>
    <div>
        <br />
        <br />
        <br />
    </div>
    <div>
        二维码图片：
        <img src="" alt="???" id="qrcodeImg" />
    </div>
</body>
</html>
